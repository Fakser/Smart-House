# flaskext.sqlalchemy

> Auto-generated documentation for [env.Lib.site-packages.flask_sqlalchemy](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py) module.

Adds basic SQLAlchemy support to your application.

- [Smart-house-rest-api](..\..\..\..\README.md#description) / [Modules](..\..\..\..\MODULES.md#smart-house-rest-api-modules) / `Env` / `Lib` / `Site-packages` / flaskext.sqlalchemy
    - [BaseQuery](#basequery)
        - [BaseQuery().first_or_404](#basequeryfirst_or_404)
        - [BaseQuery().get_or_404](#basequeryget_or_404)
        - [BaseQuery().paginate](#basequerypaginate)
    - [Model](#model)
    - [Pagination](#pagination)
        - [Pagination().has_next](#paginationhas_next)
        - [Pagination().has_prev](#paginationhas_prev)
        - [Pagination().iter_pages](#paginationiter_pages)
        - [Pagination().next](#paginationnext)
        - [Pagination().next_num](#paginationnext_num)
        - [Pagination().pages](#paginationpages)
        - [Pagination().prev](#paginationprev)
        - [Pagination().prev_num](#paginationprev_num)
    - [SQLAlchemy](#sqlalchemy)
        - [SQLAlchemy().apply_driver_hacks](#sqlalchemyapply_driver_hacks)
        - [SQLAlchemy().apply_pool_defaults](#sqlalchemyapply_pool_defaults)
        - [SQLAlchemy().create_all](#sqlalchemycreate_all)
        - [SQLAlchemy().create_scoped_session](#sqlalchemycreate_scoped_session)
        - [SQLAlchemy().create_session](#sqlalchemycreate_session)
        - [SQLAlchemy().drop_all](#sqlalchemydrop_all)
        - [SQLAlchemy().engine](#sqlalchemyengine)
        - [SQLAlchemy().get_app](#sqlalchemyget_app)
        - [SQLAlchemy().get_binds](#sqlalchemyget_binds)
        - [SQLAlchemy().get_engine](#sqlalchemyget_engine)
        - [SQLAlchemy().get_tables_for_bind](#sqlalchemyget_tables_for_bind)
        - [SQLAlchemy().init_app](#sqlalchemyinit_app)
        - [SQLAlchemy().make_connector](#sqlalchemymake_connector)
        - [SQLAlchemy().make_declarative_base](#sqlalchemymake_declarative_base)
        - [SQLAlchemy().metadata](#sqlalchemymetadata)
        - [SQLAlchemy().reflect](#sqlalchemyreflect)
    - [SignallingSession](#signallingsession)
        - [SignallingSession().get_bind](#signallingsessionget_bind)
    - [get_debug_queries](#get_debug_queries)
    - [get_state](#get_state)
    - Modules
        - [flaskext.sqlalchemy._compat](_compat.md#flaskextsqlalchemy_compat)

:copyright: (c) 2014 by Armin Ronacher, Daniel Neuhäuser.
:license: BSD, see LICENSE for more details.

#### Attributes

- `connection_stack` - Which stack should we use?  _app_ctx_stack is new in 0.9: `_app_ctx_stack or _request_ctx_stack`

## BaseQuery

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L407)

```python
class BaseQuery(orm.Query):
```

The default query object used for models, and exposed as
attribute `~SQLAlchemy.Query`. This can be subclassed and
replaced for individual models by setting the attribute `~Model.query_class`
attribute.  This is a subclass of a standard SQLAlchemy
class `sqlalchemy.orm.query.Query` class and has all the methods of a
standard query as well.

### BaseQuery().first_or_404

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L425)

```python
def first_or_404():
```

Like :meth:`first` but aborts with 404 if not found instead of
returning `None`.

### BaseQuery().get_or_404

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L416)

```python
def get_or_404(ident):
```

Like :meth:`get` but aborts with 404 if not found instead of
returning `None`.

### BaseQuery().paginate

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L434)

```python
def paginate(page=None, per_page=None, error_out=True):
```

Returns `per_page` items from page `page`.  By default it will
abort with 404 if no items were found and the page was larger than
1.  This behavor can be disabled by setting `error_out` to `False`.

If page or per_page are None, they will be retrieved from the
request query.  If the values are not ints and ``error_out`` is
true, it will abort with 404.  If there is no request or they
aren't in the query, they default to page 1 and 20
respectively.

Returns an :class:[Pagination](#pagination) object.

## Model

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L631)

```python
class Model(object):
```

Baseclass for custom user models.

#### Attributes

- `query_class` - : the query class used.  The :attr:`query` attribute is an instance
  : of this class.  By default a :class:`BaseQuery` is used.: `BaseQuery`
- `query` - : an instance of :attr:`query_class`.  Can be used to query the
  : database for instances of this model.: `None`

## Pagination

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L308)

```python
class Pagination(object):
    def __init__(query, page, per_page, total, items):
```

Internal helper class returned by :meth:[BaseQuery().paginate](#basequerypaginate).  You
can also construct it from any other SQLAlchemy query object if you are
working with other libraries.  Additionally it is possible to pass `None`
as query object in which case the :meth:`prev` and :meth:`next` will
no longer work.

### Pagination().has_next

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L360)

```python
@property
def has_next():
```

True if a next page exists.

### Pagination().has_prev

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L349)

```python
@property
def has_prev():
```

True if a previous page exists

### Pagination().iter_pages

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L370)

```python
def iter_pages(left_edge=2, left_current=2, right_current=5, right_edge=2):
```

Iterates over the page numbers in the pagination.  The four
parameters control the thresholds how many numbers should be produced
from the sides.  Skipped page numbers are represented as `None`.
This is how you could render such a pagination in the templates:

html+jinja

{% macro render_pagination(pagination, endpoint) %}
  <div class=pagination>
  {%- for page in pagination.iter_pages() %}
    {% if page %}
      {% if page != pagination.page %}
        <a href="{{ url_for(endpoint, page=page) }}">{{ page }}</a>
      {% else %}
        <strong>{{ page }}</strong>
      {% endif %}
    {% else %}
      <span class=ellipsis>…</span>
    {% endif %}
  {%- endfor %}
  </div>
{% endmacro %}

### Pagination().next

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L354)

```python
def next(error_out=False):
```

Returns a :class:[Pagination](#pagination) object for the next page.

### Pagination().next_num

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L365)

```python
@property
def next_num():
```

Number of the next page

### Pagination().pages

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L329)

```python
@property
def pages():
```

The total number of pages

### Pagination().prev

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L338)

```python
def prev(error_out=False):
```

Returns a :class:[Pagination](#pagination) object for the previous page.

### Pagination().prev_num

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L344)

```python
@property
def prev_num():
```

Number of the previous page.

## SQLAlchemy

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L643)

```python
class SQLAlchemy(object):
    def __init__(
        app=None,
        use_native_unicode=True,
        session_options=None,
        metadata=None,
    ):
```

This class is used to control the SQLAlchemy integration to one
or more Flask applications.  Depending on how you initialize the
object it is usable right away or will attach as needed to a
Flask application.

There are two usage modes which work very similarly.  One is binding
the instance to a very specific Flask application

```python
app = Flask(__name__)
db = SQLAlchemy(app)
```

The second possibility is to create the object once and configure the
application later to support it

```python
db = SQLAlchemy()

def create_app():
    app = Flask(__name__)
    db.init_app(app)
    return app
```

The difference between the two is that in the first case methods like
:meth:`create_all` and :meth:`drop_all` will work all the time but in
the second case a :meth:`flask.Flask.app_context` has to exist.

By default Flask-SQLAlchemy will apply some backend-specific settings
to improve your experience with them.  As of SQLAlchemy 0.6 SQLAlchemy
will probe the library for native unicode support.  If it detects
unicode it will let the library handle that, otherwise do that itself.
Sometimes this detection can fail in which case you might want to set
`use_native_unicode` (or the ``SQLALCHEMY_NATIVE_UNICODE`` configuration
key) to `False`.  Note that the configuration key overrides the
value you pass to the constructor.

This class also provides access to all the SQLAlchemy functions and classes
from the :mod:`sqlalchemy` and :mod:`sqlalchemy.orm` modules.  So you can
declare models like this

```python
class User(db.Model):
    username = db.Column(db.String(80), unique=True)
    pw_hash = db.Column(db.String(80))
```

You can still use :mod:`sqlalchemy` and :mod:`sqlalchemy.orm` directly, but
note that Flask-SQLAlchemy customizations are available only through an
instance of this :class:[SQLAlchemy](#sqlalchemy) class.  Query classes default to
:class:[BaseQuery](#basequery) for `db.Query`, `db.Model.query_class`, and the default
query_class for `db.relationship` and `db.backref`.  If you use these
interfaces through :mod:`sqlalchemy` and :mod:`sqlalchemy.orm` directly,
the default query class will be that of :mod:`sqlalchemy`.

Check types carefully

Don't perform type or `isinstance` checks against `db.Table`, which
emulates `Table` behavior but is not a class. `db.Table` exposes the
`Table` interface, but is a function which allows omission of metadata.

You may also define your own SessionExtension instances as well when
defining your SQLAlchemy class instance. You may pass your custom instances
to the `session_extensions` keyword. This can be either a single
SessionExtension instance, or a list of SessionExtension instances. In the
following use case we use the VersionedListener from the SQLAlchemy
versioning examples.

```python
from history_meta import VersionedMeta, VersionedListener

app = Flask(__name__)
db = SQLAlchemy(app, session_extensions=[VersionedListener()])

class User(db.Model):
    __metaclass__ = VersionedMeta
    username = db.Column(db.String(80), unique=True)
    pw_hash = db.Column(db.String(80))
```

The `session_options` parameter can be used to override session
options.  If provided it's a dict of parameters passed to the
session's constructor.

#### Notes

Added in version 0.10
   The `session_options` parameter was added.

Added in version 0.16
   `scopefunc` is now accepted on `session_options`. It allows specifying
    a custom function which will define the SQLAlchemy session's scoping.

Added in version 2.1
   The `metadata` parameter was added. This allows for setting custom
   naming conventions among other, non-trivial things.

### SQLAlchemy().apply_driver_hacks

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L836)

```python
def apply_driver_hacks(app, info, options):
```

This method is called before engine creation and used to inject
driver specific hacks into the options.  The `options` parameter is
a dictionary of keyword arguments that will then be used to call
the :func:`sqlalchemy.create_engine` function.

The default implementation provides some saner defaults for things
like pool sizes for MySQL and sqlite.  Also it injects the setting of
`SQLALCHEMY_NATIVE_UNICODE`.

### SQLAlchemy().apply_pool_defaults

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L826)

```python
def apply_pool_defaults(app, options):
```

### SQLAlchemy().create_all

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L966)

```python
def create_all(bind='__all__', app=None):
```

Creates all tables.

#### Notes

Changed in version 0.12
   Parameters were added

### SQLAlchemy().create_scoped_session

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L755)

```python
def create_scoped_session(options=None):
```

Helper factory method that creates a scoped session.  It
internally calls :meth:[SQLAlchemy().create_session](#sqlalchemycreate_session).

### SQLAlchemy().create_session

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L765)

```python
def create_session(options):
```

Creates the session.  The default implementation returns a
:class:[SignallingSession](#signallingsession).

#### Notes

Added in version 2.0

### SQLAlchemy().drop_all

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L974)

```python
def drop_all(bind='__all__', app=None):
```

Drops all tables.

#### Notes

Changed in version 0.12
   Parameters were added

### SQLAlchemy().engine

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L885)

```python
@property
def engine():
```

Gives access to the engine.  If the database configuration is bound
to a specific application (initialized with an application) this will
always return a database connection.  If however the current application
is used this might raise a exception `RuntimeError` if no application is
active at the moment.

### SQLAlchemy().get_app

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L912)

```python
def get_app(reference_app=None):
```

Helper method that implements the logic to look up an application.

### SQLAlchemy().get_binds

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L934)

```python
def get_binds(app=None):
```

Returns a dictionary with a table->engine mapping.

This is suitable for use of sessionmaker(binds=db.get_binds(app)).

### SQLAlchemy().get_engine

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L899)

```python
def get_engine(app, bind=None):
```

Returns a specific engine.

#### Notes

Added in version 0.12

### SQLAlchemy().get_tables_for_bind

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L926)

```python
def get_tables_for_bind(bind=None):
```

Returns a list of all tables relevant for a bind.

### SQLAlchemy().init_app

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L781)

```python
def init_app(app):
```

This callback can be used to initialize an application for the
use with this database setup.  Never use a database in the context
of an application not initialized that way or connections will
leak.

### SQLAlchemy().make_connector

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L895)

```python
def make_connector(app, bind=None):
```

Creates the connector for a given state and bind.

### SQLAlchemy().make_declarative_base

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L773)

```python
def make_declarative_base(metadata=None):
```

Creates the declarative base.

### SQLAlchemy().metadata

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L750)

```python
@property
def metadata():
```

Returns the metadata

### SQLAlchemy().reflect

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L982)

```python
def reflect(bind='__all__', app=None):
```

Reflects tables from the database.

#### Notes

Changed in version 0.12
   Parameters were added

## SignallingSession

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L136)

```python
class SignallingSession(SessionBase):
    def __init__(db, autocommit=False, autoflush=True, app=None, **options):
```

The signalling session is the default session that Flask-SQLAlchemy
uses.  It extends the default session system with bind selection and
modification tracking.

If you want to use a different session you can override the
:meth:[SQLAlchemy().create_session](#sqlalchemycreate_session) function.

#### Notes

Added in version 2.0

Added in version 2.1
    The `binds` option was added, which allows a session to be joined
    to an external transaction.

### SignallingSession().get_bind

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L166)

```python
def get_bind(mapper=None, clause=None):
```

## get_debug_queries

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L273)

```python
def get_debug_queries():
```

In debug mode Flask-SQLAlchemy will log all the SQL queries sent
to the database.  This information is available until the end of request
which makes it possible to easily ensure that the SQL generated is the
one expected on errors or in unittesting.  If you don't want to enable
the DEBUG mode for your unittests you can also enable the query
recording by setting the ``'SQLALCHEMY_RECORD_QUERIES'`` config variable
to `True`.  This is automatically enabled if Flask is in testing mode.

The value returned will be a list of named tuples with the following
attributes:

`statement`
    The SQL statement issued

`parameters`
    The parameters for the SQL statement

`start_time` / `end_time`
    Time the query started / the results arrived.  Please keep in mind
    that the timer function used depends on your platform. These
    values are only useful for sorting or comparing.  They do not
    necessarily represent an absolute timestamp.

`duration`
    Time the query took in seconds

`context`
    A string giving a rough estimation of where in your application
    query was issued.  The exact format is undefined so don't try
    to reconstruct filename or function name.

## get_state

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\flask_sqlalchemy\__init__.py#L614)

```python
def get_state(app):
```

Gets the state for the application
