# Sandbox

> Auto-generated documentation for [env.Lib.site-packages.jinja2.sandbox](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py) module.

A sandbox layer that ensures unsafe operations cannot be performed.
Useful when the template itself comes from an untrusted source.

- [Smart-house-rest-api](..\..\..\..\README.md#description) / [Modules](..\..\..\..\MODULES.md#smart-house-rest-api-modules) / `Env` / `Lib` / `Site-packages` / [Jinja2](index.md#jinja2) / Sandbox
    - [ImmutableSandboxedEnvironment](#immutablesandboxedenvironment)
        - [ImmutableSandboxedEnvironment().is_safe_attribute](#immutablesandboxedenvironmentis_safe_attribute)
    - [SandboxedEnvironment](#sandboxedenvironment)
        - [SandboxedEnvironment().call](#sandboxedenvironmentcall)
        - [SandboxedEnvironment().call_binop](#sandboxedenvironmentcall_binop)
        - [SandboxedEnvironment().call_unop](#sandboxedenvironmentcall_unop)
        - [SandboxedEnvironment().format_string](#sandboxedenvironmentformat_string)
        - [SandboxedEnvironment().getattr](#sandboxedenvironmentgetattr)
        - [SandboxedEnvironment().getitem](#sandboxedenvironmentgetitem)
        - [SandboxedEnvironment().intercept_unop](#sandboxedenvironmentintercept_unop)
        - [SandboxedEnvironment().is_safe_attribute](#sandboxedenvironmentis_safe_attribute)
        - [SandboxedEnvironment().is_safe_callable](#sandboxedenvironmentis_safe_callable)
        - [SandboxedEnvironment().unsafe_undefined](#sandboxedenvironmentunsafe_undefined)
    - [SandboxedEscapeFormatter](#sandboxedescapeformatter)
    - [SandboxedFormatter](#sandboxedformatter)
    - [SandboxedFormatterMixin](#sandboxedformattermixin)
        - [SandboxedFormatterMixin().get_field](#sandboxedformattermixinget_field)
    - [formatter_field_name_split](#formatter_field_name_split)
    - [inspect_format_method](#inspect_format_method)
    - [is_internal_attribute](#is_internal_attribute)
    - [modifies_known_mutable](#modifies_known_mutable)
    - [safe_range](#safe_range)
    - [unsafe](#unsafe)

#### Attributes

- `MAX_RANGE` - : maximum number of items a range may produce: `100000`
- `UNSAFE_FUNCTION_ATTRIBUTES` - On versions > python 2 the special attributes on functions are gone,
  but they remain on methods and generators for whatever reason.: `set()`
- `UNSAFE_METHOD_ATTRIBUTES` - : unsafe method attributes.  function attributes are unsafe for methods too: `{'im_class', 'im_func', 'im_self'}`
- `UNSAFE_GENERATOR_ATTRIBUTES` - : unsafe generator attributes.: `{'gi_frame', 'gi_code'}`
- `UNSAFE_COROUTINE_ATTRIBUTES` - : unsafe attributes on coroutines: `{'cr_frame', 'cr_code'}`
- `UNSAFE_ASYNC_GENERATOR_ATTRIBUTES` - : unsafe attributes on async generators: `{'ag_code', 'ag_frame'}`

## ImmutableSandboxedEnvironment

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L465)

```python
class ImmutableSandboxedEnvironment(SandboxedEnvironment):
```

Works exactly like the regular [SandboxedEnvironment](#sandboxedenvironment) but does not
permit modifications on the builtin mutable objects `list`, `set`, and
`dict` by using the :func:[modifies_known_mutable](#modifies_known_mutable) function.

#### See also

- [SandboxedEnvironment](#sandboxedenvironment)

### ImmutableSandboxedEnvironment().is_safe_attribute

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L471)

```python
def is_safe_attribute(obj, attr, value):
```

## SandboxedEnvironment

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L259)

```python
class SandboxedEnvironment(Environment):
    def __init__(*args, **kwargs):
```

The sandboxed environment.  It works like the regular environment but
tells the compiler to generate sandboxed code.  Additionally subclasses of
this environment may override the methods that tell the runtime what
attributes or functions are safe to access.

If the template tries to access insecure code a exception `SecurityError` is
raised.  However also other exceptions may occur during the rendering so
the caller has to ensure that all exceptions are caught.

#### Attributes

- `default_binop_table` - : default callback table for the binary operators.  A copy of this is
  : available on each instance of a sandboxed environment as
  : :attr:`binop_table`: `{'+': operator.add, '-': operator.sub, '*': ope...`
- `default_unop_table` - : default callback table for the unary operators.  A copy of this is
  : available on each instance of a sandboxed environment as
  : :attr:`unop_table`: `{'+': operator.pos, '-': operator.neg}`
- `intercepted_binops` - : a set of binary operators that should be intercepted.  Each operator
  : that is added to this set (empty by default) is delegated to the
  : :meth:`call_binop` method that will perform the operator.  The default
  : operator callback is specified by :attr:`binop_table`.
  :
  : The following binary operators are interceptable:
  : ``//``, ``%``, ``+``, ``*``, ``-``, ``/``, and ``**``
  :
  : The default operation form the operator table corresponds to the
  : builtin function.  Intercepted calls are always slower than the native
  : operator call, so make sure only to intercept the ones you are
  : interested in.
  :
  : .. versionadded:: 2.6: `frozenset()`
- `intercepted_unops` - : a set of unary operators that should be intercepted.  Each operator
  : that is added to this set (empty by default) is delegated to the
  : :meth:`call_unop` method that will perform the operator.  The default
  : operator callback is specified by :attr:`unop_table`.
  :
  : The following unary operators are interceptable: ``+``, ``-``
  :
  : The default operation form the operator table corresponds to the
  : builtin function.  Intercepted calls are always slower than the native
  : operator call, so make sure only to intercept the ones you are
  : interested in.
  :
  : .. versionadded:: 2.6: `frozenset()`

### SandboxedEnvironment().call

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L452)

```python
def call(__context, __obj, *args, **kwargs):
```

Call an object from sandboxed code.

### SandboxedEnvironment().call_binop

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L363)

```python
def call_binop(context, operator, left, right):
```

For intercepted binary operator calls (:meth:[intercepted_binops](#sandboxedenvironment))
this function is executed instead of the builtin operator.  This can
be used to fine tune the behavior of certain operators.

#### Notes

Added in version 2.6

### SandboxedEnvironment().call_unop

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L372)

```python
def call_unop(context, operator, arg):
```

For intercepted unary operator calls (:meth:[intercepted_unops](#sandboxedenvironment))
this function is executed instead of the builtin operator.  This can
be used to fine tune the behavior of certain operators.

#### Notes

Added in version 2.6

### SandboxedEnvironment().format_string

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L429)

```python
def format_string(s, args, kwargs, format_func=None):
```

If a format call is detected, then this is routed through this
method so that our safety sandbox can be used for it.

### SandboxedEnvironment().getattr

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L402)

```python
def getattr(obj, attribute):
```

Subscribe an object from sandboxed code and prefer the
attribute.  The attribute passed *must* be a bytestring.

### SandboxedEnvironment().getitem

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L381)

```python
def getitem(obj, argument):
```

Subscribe an object from sandboxed code.

### SandboxedEnvironment().intercept_unop

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L321)

```python
def intercept_unop(operator):
```

Called during template compilation with the name of a unary
operator to check if it should be intercepted at runtime.  If this
method returns `True`, :meth:[SandboxedEnvironment().call_unop](#sandboxedenvironmentcall_unop) is executed for this unary
operator.  The default implementation of :meth:[SandboxedEnvironment().call_unop](#sandboxedenvironmentcall_unop) will use
the attribute `unop_table` dictionary to perform the operator with the
same logic as the builtin one.

The following unary operators are interceptable: ``+`` and ``-``

Intercepted calls are always slower than the native operator call,
so make sure only to intercept the ones you are interested in.

#### Notes

Added in version 2.6

### SandboxedEnvironment().is_safe_attribute

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L344)

```python
def is_safe_attribute(obj, attr, value):
```

The sandboxed environment will call this method to check if the
attribute of an object is safe to access.  Per default all attributes
starting with an underscore are considered private as well as the
special attributes of internal python objects as returned by the
:func:[is_internal_attribute](#is_internal_attribute) function.

### SandboxedEnvironment().is_safe_callable

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L353)

```python
def is_safe_callable(obj):
```

Check if an object is safely callable.  Per default a function is
considered safe unless the `unsafe_callable` attribute exists and is
True.  Override this method to alter the behavior, but this won't
affect the [unsafe](#unsafe) decorator from this module.

### SandboxedEnvironment().unsafe_undefined

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L419)

```python
def unsafe_undefined(obj, attribute):
```

Return an undefined object for unsafe attributes.

## SandboxedEscapeFormatter

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L507)

```python
class SandboxedEscapeFormatter(SandboxedFormatterMixin, EscapeFormatter):
    def __init__(env, escape):
```

#### See also

- [SandboxedFormatterMixin](#sandboxedformattermixin)

## SandboxedFormatter

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L501)

```python
class SandboxedFormatter(SandboxedFormatterMixin, Formatter):
    def __init__(env):
```

#### See also

- [SandboxedFormatterMixin](#sandboxedformattermixin)

## SandboxedFormatterMixin

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L486)

```python
class SandboxedFormatterMixin(object):
    def __init__(env):
```

### SandboxedFormatterMixin().get_field

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L490)

```python
def get_field(field_name, args, kwargs):
```

## formatter_field_name_split

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L482)

```python
def formatter_field_name_split(field_name):
```

## inspect_format_method

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L156)

```python
def inspect_format_method(callable):
```

## is_internal_attribute

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L194)

```python
def is_internal_attribute(obj, attr):
```

Test if the attribute given is an internal python attribute.  For
example this function returns `True` for the `func_code` attribute of
python objects.  This is useful if the environment method
:meth:`~SandboxedEnvironment.is_safe_attribute` is overridden.

```python
>>> from jinja2.sandbox import is_internal_attribute
>>> is_internal_attribute(str, "mro")
True
>>> is_internal_attribute(str, "upper")
False

## modifies_known_mutable

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L231)

```python
def modifies_known_mutable(obj, attr):
```

This function checks if an attribute on a builtin mutable object
(list, dict, set or deque) would modify it if called.  It also supports
the "user"-versions of the objects (`sets.Set`, `UserDict.*` etc.) and
with Python 2.6 onwards the abstract base classes `MutableSet`,
`MutableMapping`, and `MutableSequence`.

```python
>>> modifies_known_mutable({}, "clear")
True
>>> modifies_known_mutable({}, "keys")
False
>>> modifies_known_mutable([], "append")
True
>>> modifies_known_mutable([], "index")
False
```

If called with an unsupported object (such as unicode) `False` is
returned.

```python
>>> modifies_known_mutable("foo", "upper")
False

## safe_range

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L166)

```python
def safe_range(*args):
```

A range that can't generate ranges with a length of more than
MAX_RANGE items.

## unsafe

[[find in source code]](..\..\..\..\..\env\Lib\site-packages\jinja2\sandbox.py#L181)

```python
def unsafe(f):
```

Marks a function or method as unsafe.

```python
@unsafe
def delete(self):
    pass
```
